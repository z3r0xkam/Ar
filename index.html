<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Text Decoder</title>
    <script src="https://cdn.jsdelivr.net/npm/webcam-easy@1.0.5/dist/webcam-easy.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.1/dist/tesseract.min.js"></script>
    <style>
        video, canvas { 
            width: 100%;
            max-width: 640px;
            margin: 10px 0;
        }
        #output {
            margin: 20px;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <video id="webcam" autoplay playsinline></video>
    <canvas id="canvas" style="display: none;"></canvas>
    <div id="output"></div>

    <script>
        const webcamElement = document.getElementById('webcam');
        const canvasElement = document.getElementById('canvas');
        const outputElement = document.getElementById('output');
        
        // Initialize webcam with back camera
        const webcam = new Webcam(webcamElement, 'environment', canvasElement);
        
        // Start webcam
        webcam.start()
            .then(result => {
                console.log("Webcam started");
                detectText();
            })
            .catch(err => {
                console.log(err);
            });

        // Target cipher text
        const targetCipher = "Zhofrph wr VHX Xqlyhuvlwb! Zh duh gholjkwhg wr kdyh brx zlwk xv wrgdb dv zh vkrzfdvh rxu dgydqfhphqwv lq frpsxwlqj vhfxulwb. Brxu ylvlw lv dq krqru, dqg zh orrn iruzdug wr lqvljkwixo glvfxvvlrqv dqg ixwxuh fROoderudwlrqv";

        function decodeCaesarCipher(str, shift) {
            return str.split('').map(char => {
                if (char.match(/[a-zA-Z]/)) {
                    const code = char.charCodeAt(0);
                    const base = code >= 65 && code <= 90 ? 65 : 97;
                    return String.fromCharCode(((code - base - shift + 26) % 26) + base);
                }
                return char;
            }).join('');
        }

        async function detectText() {
            while (true) {
                // Capture frame from webcam
                const picture = webcam.snap();
                canvasElement.src = picture;

                // Recognize text
                const result = await Tesseract.recognize(
                    canvasElement,
                    'eng',
                    { logger: m => console.log(m) }
                );

                let detectedText = result.data.text
                    .replace(/\n/g, ' ')  // Replace newlines with spaces
                    .replace(/[^a-zA-Z\s!.]/g, ''); // Clean up special characters

                // Convert to uppercase to match target cipher format
                detectedText = detectedText.toUpperCase();

                // Check if detected text matches target cipher
                if (detectedText.includes(targetCipher)) {
                    const decodedMessage = decodeCaesarCipher(targetCipher, 3);
                    outputElement.innerHTML = `Decoded Message: ${decodedMessage}`;
                    break;
                } else {
                    outputElement.innerHTML = 'Scanning... No match found yet';
                }

                // Wait before next detection
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
        }
    </script>
</body>
</html>
